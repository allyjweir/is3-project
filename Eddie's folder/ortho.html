<!DOCTYPE html>
<meta charset="utf-8">
<style>

    body {
        background: #030303;
    }

    .stroke {
        fill: none;
        stroke: #000;
        stroke-width: 3px;
    }

    .fill {
        fill: #000628;
    }

    .graticule {
        fill: none;
        stroke: #000;
        stroke-width: .5px;
        stroke-opacity: .5;
    }

    .land {
        stroke: #000;
        stroke-width: .5px;
        fill: none;
    }

    .boundary {
        fill: none;
        stroke: #000;
        stroke-width: .5px;
    }

</style>
<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script>

        var width = screen.availWidth;,
        height = 800;

        var color = d3.scale.linear().domain([1,10]).range(['#0c0a40', '#2e71ff']);// JMcghee - Generates a collection of colours from a linear gradient using 10 stops

        var projection = d3.geo.mercator()
        .scale(150)
        .translate([width / 2, height / 2])
        .precision(.1);

        var path = d3.geo.path()
        .projection(projection);

        var graticule = d3.geo.graticule();

        var lambda = d3.scale.linear()
        .domain([0, width])
        .range([-180, 180]);

        var phi = d3.scale.linear()
        .domain([0, height])
        .range([90, -90]);

        var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

        svg.append("defs").append("path")
        .datum({type: "Sphere"})
        .attr("id", "sphere")
        .attr("d", path);

        svg.append("use")
        .attr("class", "stroke")
        .attr("xlink:href", "#sphere");

        svg.append("use")
        .attr("class", "fill")
        .attr("xlink:href", "#sphere");

        svg.append("path")
        .datum(graticule)
        .attr("class", "graticule")
        .attr("d", path);

		
	 	//LM added for ctz functionality
	   svg.append("rect")
	   .attr("class", "background")
	   .attr("width", width)
	   .attr("height", height)
	   .on("click", clicked);
	   
	   var g = svg.append("g");
	   
        d3.json("world-110m.json", function(error, world) {
            var countries = topojson.feature(world, world.objects.countries).features,
            neighbors = topojson.neighbors(world.objects.countries.geometries);//JMcGhee - Load the geometries of each country to avoid awful-looking clipping

            g.selectAll(".country")
            .data(countries)
            .enter().insert("path", ".graticule")
            .attr("class", "country")
            .attr("d", path)
            .style("fill",function(d){return color(Math.floor((Math.random()*10)+1)); //JMcGhee - Drawing each country, style with a fill color from an embedded function (currently random but could be any predefined function)
            
            //LM added for ctz functionality 
            g.append("g")
       	  .attr("class", "country")
            .selectAll("path")
            .data(topojson.feature(world , world.objects.countries).features)
            .enter().append("path")
            .attr("d", path)
            .on("click", clicked);
            
            }); 


        
        g.insert("path", ".graticule")
            .datum(topojson.feature(world, world.objects.land))
            .attr("class", "land")
            .attr("d", path);

            g.insert("path", ".graticule")
            .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
            .attr("class", "boundary")
            .attr("d", path)
           // .style("fill",color(1));
        });

		//LM added for ctz functionality
		function clicked(d) {
		  var x, y, k;

		  if (d && centered !== d) {
		    var centroid = path.centroid(d);
		    x = centroid[0];
		    y = centroid[1];
		    k = 4;
		    centered = d;
		  } else {
		    x = width / 2;
		    y = height / 2;
		    k = 1;
		    centered = null;
		  }

		  g.selectAll("path")
		      .classed("active", centered && function(d) { return d === centered; });

		  g.transition()
		      .duration(750)
		      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
		      .style("stroke-width", 1.5 / k + "px");
		}

		        d3.select(self.frameElement).style("height", height + "px");

    </script>

